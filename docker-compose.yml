version: '3'

services:
  ros1_bridge:
    image: wdsdrones/wds_ros1_to_ros2_humble_bridge:latest
    volumes:
      - /home/root/wds/WDS_generalTools/ros1_bridge_ws/src/ros-humble-ros1-bridge-builder/config/:/home/topics
      - ./fastdds_config.xml:/home/fastdds_config.xml
        
    environment:
      - RMW_IMPLEMENTATION=rmw_cyclonedds_cpp

      - RCUTILS_COLORIZED_OUTPUT=1
      - ROS_DOMAIN_ID=23
      - ROS_IP=127.0.0.1
      - ROS_MASTER_URI=http://127.0.0.1:11311
      - FASTRTPS_DEFAULT_PROFILES_FILE=/home/fastdds_config.xml
    
    platform: linux/arm64/v8

    command: >
      bash -c "
      source /opt/ros/humble/setup.bash && 
      source /ros-humble-ros1-bridge/install/setup.bash &&
    
      rosparam load /home/topics/bridge_topic.yaml &&
      ros2 run ros1_bridge parameter_bridge"

    restart: unless-stopped
    network_mode: "host"
    privileged: true